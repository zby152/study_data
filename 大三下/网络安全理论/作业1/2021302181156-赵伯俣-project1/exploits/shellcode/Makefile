CC=gcc
CFLAGS=-Wall -fno-stack-protector -z execstack
OBJDUMP=objdump
NASM=nasm
LD=ld
LDFLAGS=-m elf_i386

SOURCE=shellcode.c
EXECUTABLE=shellcode
DISASSEMBLY=shellcode.s
ASM_SOURCE=scode.asm
ASM_OBJECT=scode.o
ASM_EXECUTABLE=scode
TEST_SOURCE=test_scode.c
TEST_EXECUTABLE=test_scode


all: $(DISASSEMBLY) $(ASM_EXECUTABLE) $(TEST_EXECUTABLE)

$(EXECUTABLE): $(SOURCE)
	$(CC) $(CFLAGS) -o $(EXECUTABLE) $(SOURCE)

$(DISASSEMBLY): $(EXECUTABLE)
	$(OBJDUMP) -d $(EXECUTABLE) > $(DISASSEMBLY)

$(ASM_OBJECT): $(ASM_SOURCE)
	$(NASM) -f elf32 $(ASM_SOURCE) -o $(ASM_OBJECT)

$(ASM_EXECUTABLE): $(ASM_OBJECT)
	$(LD) $(LDFLAGS) -o $(ASM_EXECUTABLE) $(ASM_OBJECT)

$(TEST_EXECUTABLE): $(TEST_SOURCE)
	$(CC) $(CFLAGS) -o $(TEST_EXECUTABLE) $(TEST_SOURCE)

clean:
	rm -f $(EXECUTABLE) $(DISASSEMBLY) $(ASM_OBJECT) $(ASM_EXECUTABLE) $(TEST_EXECUTABLE)

.PHONY: all clean

